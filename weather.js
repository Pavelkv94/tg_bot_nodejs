// let options = {
//     url: "https://openweathermap.org/data/2.5/weather?id=625144&appid=439d4b804bc8187953eb36d2a8c26a02",
// };

// let options = {
//     url: "https://www.onliner.by/sdapi/pogoda/api/forecast",
// };


// {
//     now: {
//       phenomena: 'Ð¡Ð¿Ð»Ð¾ÑˆÐ½Ð°Ñ Ð¾Ð±Ð»Ð°Ñ‡Ð½Ð¾ÑÑ‚ÑŒ',
//       falloutIcon: 'A10',
//       pressureTitle: '757 Ð¼Ð¼ Ñ€Ñ‚. ÑÑ‚.',
//       temperature: '+9',
//       windDirection: 'S',
//       wind: {
//         direction: [Object],
//         speed: [Array],
//         gustsSpeed: 0,
//         unstable: false
//       }
//     },
//     forecast: {
//       '2021-09-24': {
//         nightTemperature: [Object],
//         dayTemperature: [Object],
//         phenomena: 'ÐŸÐµÑ€ÐµÐ¼ÐµÐ½Ð½Ð°Ñ Ð¾Ð±Ð»Ð°Ñ‡Ð½Ð¾ÑÑ‚ÑŒ, Ð½ÐµÐ±Ð¾Ð»ÑŒÑˆÐ¾Ð¹ Ð´Ð¾Ð¶Ð´ÑŒ',
//         falloutIcon: 'D6',
//         weekend: '',
//         pressureTitle: '746 Ð¼Ð¼ Ñ€Ñ‚. ÑÑ‚.',
//         humidityTitle: '90%',
//         dateTextDayOfWeek: 'Ð·Ð°Ð²Ñ‚Ñ€Ð°',
//         dayOfMonth: '24',
//         windDirection: 'W',
//         wind: [Object]
//       },
//       '2021-09-25': {
//         nightTemperature: [Object],
//         dayTemperature: [Object],
//         phenomena: 'ÐŸÐµÑ€ÐµÐ¼ÐµÐ½Ð½Ð°Ñ Ð¾Ð±Ð»Ð°Ñ‡Ð½Ð¾ÑÑ‚ÑŒ, Ð½ÐµÐ±Ð¾Ð»ÑŒÑˆÐ¾Ð¹ Ð´Ð¾Ð¶Ð´ÑŒ',
//         falloutIcon: 'D6',
//         weekend: 'weekend',
//         pressureTitle: '755 Ð¼Ð¼ Ñ€Ñ‚. ÑÑ‚.',
//         humidityTitle: '90%',
//         dateTextDayOfWeek: 'ÑÑƒÐ±Ð±Ð¾Ñ‚Ð°',
//         dayOfMonth: '25',
//         windDirection: 'W',
//         wind: [Object]
//       },
//       '2021-09-26': {
//         nightTemperature: [Object],
//         dayTemperature: [Object],
//         phenomena: 'ÐœÐ°Ð»Ð¾Ð¾Ð±Ð»Ð°Ñ‡Ð½Ð¾, Ð²Ð¾Ð·Ð¼Ð¾Ð¶ÐµÐ½ Ð´Ð¾Ð¶Ð´ÑŒ',
//         falloutIcon: 'D4',
//         weekend: 'weekend',
//         pressureTitle: '766 Ð¼Ð¼ Ñ€Ñ‚. ÑÑ‚.',
//         humidityTitle: '60%',
//         dateTextDayOfWeek: 'Ð²Ð¾ÑÐºÑ€ÐµÑÐµÐ½ÑŒÐµ',
//         dayOfMonth: '26',
//         windDirection: 'NW',
//         wind: [Object]
//       },
//       '2021-09-27': {
//         nightTemperature: [Object],
//         dayTemperature: [Object],
//         phenomena: 'ÐœÐ°Ð»Ð¾Ð¾Ð±Ð»Ð°Ñ‡Ð½Ð¾, Ð²Ð¾Ð·Ð¼Ð¾Ð¶ÐµÐ½ Ð´Ð¾Ð¶Ð´ÑŒ',
//         falloutIcon: 'D4',
//         weekend: '',
//         pressureTitle: '770 Ð¼Ð¼ Ñ€Ñ‚. ÑÑ‚.',
//         humidityTitle: '60%',
//         dateTextDayOfWeek: 'Ð¿Ð¾Ð½ÐµÐ´ÐµÐ»ÑŒÐ½Ð¸Ðº',
//         dayOfMonth: '27',
//         windDirection: 'NE',
//         wind: [Object]
//       },
//       '2021-09-28': {
//         nightTemperature: [Object],
//         dayTemperature: [Object],
//         phenomena: 'ÐœÐ°Ð»Ð¾Ð¾Ð±Ð»Ð°Ñ‡Ð½Ð¾, Ð½ÐµÐ±Ð¾Ð»ÑŒÑˆÐ¾Ð¹ Ð´Ð¾Ð¶Ð´ÑŒ',
//         falloutIcon: 'D4',
//         weekend: '',
//         pressureTitle: '774 Ð¼Ð¼ Ñ€Ñ‚. ÑÑ‚.',
//         humidityTitle: '65%',
//         dateTextDayOfWeek: 'Ð²Ñ‚Ð¾Ñ€Ð½Ð¸Ðº',
//         dayOfMonth: '28',
//         windDirection: 'E',
//         wind: [Object]
//       }
//     },
//     today: {
//       date: '23 ÑÐµÐ½Ñ‚ÑÐ±Ñ€Ñ',
//       day: {
//         phenomena: 'Ð¯ÑÐ½Ð¾, Ð´Ñ‹Ð¼ÐºÐ°',
//         falloutIcon: 'B1',
//         temperature: '+6',
//         rusDateTime: 'Ð´Ð½ÐµÐ¼'
//       },
//       evening: {
//         phenomena: 'Ð¯ÑÐ½Ð¾',
//         falloutIcon: 'A2',
//         temperature: '+6',
//         rusDateTime: 'Ð²ÐµÑ‡ÐµÑ€Ð¾Ð¼'
//       },
//       night: {
//         phenomena: 'ÐžÐ±Ð»Ð°Ñ‡Ð½Ð¾ Ñ Ð¿Ñ€Ð¾ÑÑÐ½ÐµÐ½Ð¸ÑÐ¼Ð¸, ÑƒÐ¼ÐµÑ€ÐµÐ½Ð½Ñ‹Ð¹ Ð´Ð¾Ð¶Ð´ÑŒ',
//         falloutIcon: 'D9',
//         temperature: '+9',
//         rusDateTime: 'Ð½Ð¾Ñ‡ÑŒÑŽ'
//       }
//     },
//     city: 'ÐœÐ¸Ð½ÑÐºÐµ'
//   }

const request = require("request");
const bot = require("./bot");
let id;
bot.on("message", async (msg) => {
  const text = msg.text;
  id = msg.chat.id;
});

function getWeather() {
  let options = {
    url: "https://www.onliner.by/sdapi/pogoda/api/forecast",
  };

   request.get(options, function (err, res, body) {
    let data = JSON.parse(body);
    let nowTemp = data.now.temperature;
    let nowWeather = data.now.phenomena;
    let date = data.today.date;
    let dayTemp = data.today.day.temperature;
    let dayWeather = data.today.day.phenomena;
    let evTemp = data.today.evening.temperature;
    let evWeather = data.today.evening.phenomena;
    let nTemp = data.today.night.temperature;
    let nWeather = data.today.night.phenomena;
    let currentTime = new Date().getHours();
    if ((currentTime > 6) & (currentTime < 12)) {
      bot.sendMessage(
        id,
        `ðŸš€ Ð”Ð¾Ð±Ñ€Ð¾Ðµ ÑƒÑ‚Ñ€Ð¾! ðŸš€
            Ð¡ÐµÐ³Ð¾Ð´Ð½Ñ ${date}, Ð¿Ñ€ÑÐ¼Ð¾ ÑÐµÐ¹Ñ‡Ð°Ñ ${nowTemp}, ${nowWeather}. ðŸ§
            ðŸŒž Ð”Ð½ÐµÐ¼ ${dayTemp}, ${dayWeather}. 
            ðŸŒ“ Ð’ÐµÑ‡ÐµÑ€Ð¾Ð¼ ${evTemp}, ${evWeather}.`
      );
    } else if ((currentTime >= 12) & (currentTime < 18)) {
      bot.sendMessage(
        id,
        `Ð¡ÐµÐ³Ð¾Ð´Ð½Ñ ${date}, Ð¿Ñ€ÑÐ¼Ð¾ ÑÐµÐ¹Ñ‡Ð°Ñ ${nowTemp}, ${nowWeather}. ðŸ§
         ðŸŒ“ Ð’ÐµÑ‡ÐµÑ€Ð¾Ð¼ ${evTemp}, ${evWeather}.
         ðŸŒ™ ÐÐ¾Ñ‡ÑŒÑŽ ${nTemp}, ${nWeather}`
      );
    } else {
        bot.sendMessage(
            id,
            `Ð¡ÐµÐ³Ð¾Ð´Ð½Ñ ${date}, Ð¿Ñ€ÑÐ¼Ð¾ ÑÐµÐ¹Ñ‡Ð°Ñ ${nowTemp}, ${nowWeather}. ðŸ§`
          );
    }
  });
}

module.exports = getWeather;
